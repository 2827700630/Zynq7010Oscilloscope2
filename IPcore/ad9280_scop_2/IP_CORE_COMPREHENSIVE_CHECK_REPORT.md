# AD9280_SCOP_2_0 IPæ ¸å…¨é¢æ£€æŸ¥æŠ¥å‘Š

## ğŸ” **æ£€æŸ¥èŒƒå›´**
- æ€»çº¿æ¥å£é€»è¾‘
- å¯„å­˜å™¨æ˜ å°„å’Œè®¿é—®æƒé™
- ä¿¡å·è¿æ¥å’Œæ•°æ®æµ
- æ—¶é’ŸåŸŸå¤„ç†
- AXIåè®®åˆè§„æ€§

## âœ… **æ£€æŸ¥ç»“æœæ±‡æ€»**

### **è¯­æ³•å’Œç¼–è¯‘æ£€æŸ¥ï¼šPASS**
- âœ… æ‰€æœ‰Verilogæ–‡ä»¶è¯­æ³•æ­£ç¡®
- âœ… æ— å¤šé‡é©±åŠ¨é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… æ— æœªè¿æ¥ç«¯å£
- âœ… æ¨¡å—å®ä¾‹åŒ–æ­£ç¡®

## ğŸ“Š **è¯¦ç»†æ£€æŸ¥ç»“æœ**

### **1. AXI4-Lite Slaveæ¥å£ (å¯„å­˜å™¨è®¿é—®)**

#### **âœ… å¯„å­˜å™¨æ˜ å°„æ­£ç¡®**
| åœ°å€ | å¯„å­˜å™¨å | è®¿é—®æƒé™ | åŠŸèƒ½ | çŠ¶æ€ |
|------|----------|----------|------|------|
| 0x00 | control_reg | R/W | æ§åˆ¶å¯„å­˜å™¨ | âœ… æ­£ç¡® |
| 0x04 | status_reg | R-Only | çŠ¶æ€å¯„å­˜å™¨ | âœ… å·²ä¿®å¤ä¸ºåªè¯» |
| 0x08 | trigger_config_reg | R/W | è§¦å‘é…ç½® | âœ… æ­£ç¡® |
| 0x0C | trigger_threshold_reg | R/W | è§¦å‘é˜ˆå€¼ | âœ… æ­£ç¡® |
| 0x10 | sample_depth_reg | R/W | é‡‡æ ·æ·±åº¦ | âœ… æ­£ç¡® |
| 0x14 | decimation_config_reg | R/W | æŠ½ç‚¹é…ç½® | âœ… æ­£ç¡® |
| 0x18 | timebase_config_reg | R/W | æ—¶åŸºé…ç½® | âœ… æ­£ç¡® |
| 0x1C | reserved_reg | R/W | ä¿ç•™å¯„å­˜å™¨ | âœ… æ­£ç¡® |

#### **ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜**
```verilog
// ä¿®å¤å‰ï¼šstatus_regå¯ä»¥è¢«é”™è¯¯å†™å…¥
3'h1:
  for ( byte_index = 0; byte_index <= (C_S_AXI_DATA_WIDTH/8)-1; byte_index = byte_index+1 )
    if ( S_AXI_WSTRB[byte_index] == 1 ) begin
      slv_reg1[(byte_index*8) +: 8] <= S_AXI_WDATA[(byte_index*8) +: 8];  // âŒ é”™è¯¯
    end

// ä¿®å¤åï¼šstatus_regçœŸæ­£åªè¯»
3'h1:
  // Status register is read-only - no write operation
  begin
  end

// å¹¶ä¸”æ·»åŠ äº†è‡ªåŠ¨æ›´æ–°é€»è¾‘
slv_reg1 <= status_reg;  // âœ… ä»å¤–éƒ¨statusä¿¡å·æ›´æ–°
```

#### **âœ… AXI4-Liteåè®®åˆè§„æ€§**
- âœ… AWVALID/AWREADYæ¡æ‰‹æ­£ç¡®
- âœ… WVALID/WREADYæ¡æ‰‹æ­£ç¡®
- âœ… BVALID/BREADYå“åº”æ­£ç¡®
- âœ… ARVALID/ARREADYæ¡æ‰‹æ­£ç¡®
- âœ… RVALID/RREADYæ•°æ®è¿”å›æ­£ç¡®
- âœ… åœ°å€è§£ç é€»è¾‘æ­£ç¡® (3ä½åœ°å€ â†’ 8ä¸ªå¯„å­˜å™¨)

### **2. AXI4-Stream Masteræ¥å£ (æ•°æ®è¾“å‡º)**

#### **âœ… åè®®å®ç°æ­£ç¡®**
```verilog
// æ•°æ®ä½å®½ï¼š8ä½ (ä¸ADCåŒ¹é…)
parameter integer C_M_AXIS_TDATA_WIDTH = 8,

// æ­£ç¡®çš„TLASTç”Ÿæˆé€»è¾‘
if ((transfer_count >= (sample_depth - 1)) || (!sampling_active && fifo_empty)) begin
    axis_tlast_fifo <= 1'b1;           // âœ… åŸºäºå®é™…é‡‡æ ·æ·±åº¦
    transfer_count <= 16'h0;
    streaming_active_reg <= 1'b0;      // âœ… è‡ªåŠ¨åœæ­¢ä¼ è¾“
end
```

#### **âœ… æµæ§åˆ¶é€»è¾‘**
- âœ… TVALID/TREADYæ¡æ‰‹æ­£ç¡®
- âœ… FIFOè¯»ä½¿èƒ½é€»è¾‘æ­£ç¡®ï¼š`fifo_rd_en = tx_en_fifo && !fifo_empty`
- âœ… èƒŒå‹å¤„ç†æ­£ç¡®
- âœ… TLASTåœ¨æ­£ç¡®æ—¶åˆ»äº§ç”Ÿ
- âœ… TSTRBä¿¡å·æ­£ç¡®ï¼š`{1{1'b1}}` (8ä½æ•°æ®)

#### **ğŸ”§ å·²ä¿®å¤çš„å¤šé‡é©±åŠ¨é—®é¢˜**
```verilog
// åˆ é™¤äº†å†²çªçš„åŸå§‹è¾“å‡ºé€»è¾‘
//assign M_AXIS_TVALID = axis_tvalid_delay;     // å·²æ³¨é‡Š
//assign M_AXIS_TDATA = stream_data_out;        // å·²æ³¨é‡Š
//assign M_AXIS_TLAST = axis_tlast_delay;       // å·²æ³¨é‡Š

// ä¿ç•™å”¯ä¸€çš„è‡ªå®šä¹‰é€»è¾‘
assign M_AXIS_TVALID = axis_tvalid_fifo;        // âœ… å”¯ä¸€é©±åŠ¨
assign M_AXIS_TDATA = stream_data_out_fifo;     // âœ… å”¯ä¸€é©±åŠ¨
assign M_AXIS_TLAST = axis_tlast_fifo;          // âœ… å”¯ä¸€é©±åŠ¨
```

### **3. æ ¸å¿ƒæ•°æ®å¤„ç†æ¨¡å—**

#### **âœ… ADCæ¥å£**
```verilog
// æ—¶é’ŸåŸŸï¼šadc_clk
input wire [7:0] adc_data,              // âœ… 8ä½ADCæ•°æ®
output wire [7:0] data_out,             // âœ… 8ä½è¾“å‡ºæ•°æ®
```

#### **âœ… è§¦å‘é€»è¾‘**
- âœ… 4ç§è§¦å‘æ¨¡å¼ï¼šauto/normal/single/external
- âœ… è§¦å‘é˜ˆå€¼é…ç½®ï¼š`trigger_threshold_reg[7:0]`
- âœ… è§¦å‘è¾¹æ²¿é€‰æ‹©ï¼šrising/falling
- âœ… è½¯ä»¶è§¦å‘æ”¯æŒ
- âœ… å¤–éƒ¨è§¦å‘åŒæ­¥å¤„ç†

#### **âœ… FIFOå®ç°**
```verilog
// XPMå¼‚æ­¥FIFO - è·¨æ—¶é’ŸåŸŸ
xpm_fifo_async #(
    .WRITE_DATA_WIDTH(8),               // âœ… 8ä½å†™å…¥
    .READ_DATA_WIDTH(8),                // âœ… 8ä½è¯»å‡º
    .FIFO_WRITE_DEPTH(FIFO_DEPTH),      // âœ… å¯é…ç½®æ·±åº¦
    .wr_clk(adc_clk),                   // âœ… ADCæ—¶é’ŸåŸŸå†™å…¥
    .rd_clk(sys_clk)                    // âœ… ç³»ç»Ÿæ—¶é’ŸåŸŸè¯»å‡º
)
```

### **4. é¡¶å±‚æ¨¡å—è¿æ¥**

#### **âœ… ä¿¡å·è¿æ¥æ­£ç¡®**
```verilog
// æ§åˆ¶ä¿¡å·æå–
assign sampling_enable = control_reg[0];        // âœ… bit 0
assign trigger_enable = control_reg[1];         // âœ… bit 1  
assign trigger_mode = control_reg[3:2];         // âœ… bit 3:2
assign trigger_edge = control_reg[4];           // âœ… bit 4
assign software_trigger = control_reg[8];       // âœ… bit 8

// çŠ¶æ€ä¿¡å·ç»„è£…
assign status_reg = {
    core_sample_count,          // [31:16] âœ… é‡‡æ ·è®¡æ•°
    6'h0,                       // [15:10] âœ… ä¿ç•™ä½
    core_acquisition_complete,  // [9]     âœ… é‡‡é›†å®Œæˆ
    core_trigger_detected,      // [8]     âœ… è§¦å‘æ£€æµ‹
    core_fifo_full,            // [7]     âœ… FIFOæ»¡
    core_fifo_empty,           // [6]     âœ… FIFOç©º
    core_sampling_active,      // [5]     âœ… é‡‡æ ·æ¿€æ´»
    5'h0                       // [4:0]   âœ… ä¿ç•™ä½
};
```

#### **ğŸ”§ å·²ä¿®å¤çš„æ•°æ®æµ**
```verilog
// ä¿®å¤å‰ï¼šå¤šé‡é©±åŠ¨
assign fifo_rd_en = core_data_ready;        // âŒ å†²çª
wire fifo_rd_en;  // AXI Masterä¹Ÿè¾“å‡ºè¿™ä¸ªä¿¡å·

// ä¿®å¤åï¼šæ­£ç¡®çš„å•å‘æ•°æ®æµ  
wire fifo_rd_en;  // AXI Masterè¾“å‡ºï¼ˆå”¯ä¸€é©±åŠ¨ï¼‰
assign core_data_ready = fifo_rd_en;        // âœ… ä½¿ç”¨AXI Masterè¾“å‡º
```

### **5. æ—¶é’ŸåŸŸç®¡ç†**

#### **âœ… è·¨æ—¶é’ŸåŸŸå¤„ç†**
```verilog
// ADCæ—¶é’ŸåŸŸ (adc_clk)
- ADCæ•°æ®é‡‡é›†
- è§¦å‘æ£€æµ‹
- FIFOå†™å…¥

// ç³»ç»Ÿæ—¶é’ŸåŸŸ (sys_clk = s00_axi_aclk)  
- å¯„å­˜å™¨è®¿é—®
- FIFOè¯»å‡º
- AXI Streamä¼ è¾“
- çŠ¶æ€æ›´æ–°
```

#### **âœ… å¤ä½ä¿¡å·**
- âœ… `adc_rst_n`: ADCæ—¶é’ŸåŸŸå¤ä½ (ä½æœ‰æ•ˆ)
- âœ… `s00_axi_aresetn`: ç³»ç»Ÿæ—¶é’ŸåŸŸå¤ä½ (ä½æœ‰æ•ˆ)
- âœ… å¤ä½ææ€§ç»Ÿä¸€

## ğŸ¯ **æ€§èƒ½å’Œèµ„æºè¯„ä¼°**

### **âœ… æ•°æ®ååé‡**
```
æœ€å¤§é‡‡æ ·ç‡ï¼šç”±ADCæ—¶é’Ÿé¢‘ç‡å†³å®š
æ•°æ®ä½å®½ï¼š8ä½
è¾“å‡ºå¸¦å®½ï¼š8ä½ Ã— AXIæ—¶é’Ÿé¢‘ç‡
ç¤ºä¾‹ï¼š100MHz AXIæ—¶é’Ÿ â†’ 800Mbpsç†è®ºå¸¦å®½
```

### **âœ… FIFOæ·±åº¦è§„åˆ’**
```verilog
parameter integer FIFO_DEPTH = 256,    // é»˜è®¤256æ·±åº¦
// ç¼“å†²æ—¶é—´ = FIFO_DEPTH / ADC_é¢‘ç‡
// 256æ·±åº¦ @ 50MHz ADC = 5.12Î¼sç¼“å†²
```

### **âœ… å¯„å­˜å™¨é»˜è®¤å€¼**
```verilog
slv_reg4 <= 16'd1920;  // é»˜è®¤é‡‡æ ·æ·±åº¦1920ç‚¹ (åˆç†çš„ç¤ºæ³¢å™¨é»˜è®¤å€¼)
// å…¶ä»–å¯„å­˜å™¨é»˜è®¤ä¸º0 (å®‰å…¨çš„åˆå§‹çŠ¶æ€)
```

## ğŸš€ **ä¼˜åŒ–å»ºè®®**

### **1. å¯é€‰çš„æ€§èƒ½ä¼˜åŒ–**
```verilog
// å¯ä»¥è€ƒè™‘çš„æ”¹è¿›(å½“å‰ä¸æ˜¯å¿…é¡»çš„)
// 1. æ·»åŠ æ•°æ®å‹ç¼©/æ‰“åŒ…é€»è¾‘
// 2. å®ç°å¯å˜FIFOæ·±åº¦
// 3. æ·»åŠ DMAçªå‘ä¼ è¾“ä¼˜åŒ–
```

### **2. è°ƒè¯•åŠŸèƒ½å¢å¼º**  
```verilog
// å¯ä»¥æ·»åŠ çš„è°ƒè¯•å¯„å­˜å™¨
// 1. FIFOæ°´ä½ç›‘æ§
// 2. ä¼ è¾“è®¡æ•°å™¨
// 3. é”™è¯¯çŠ¶æ€æ ‡å¿—
```

## ğŸ“‹ **æ€»ç»“**

### **âœ… æ£€æŸ¥é€šè¿‡é¡¹ç›®**
- âœ… æ‰€æœ‰è¯­æ³•é”™è¯¯å·²è§£å†³
- âœ… å¤šé‡é©±åŠ¨é—®é¢˜å·²ä¿®å¤
- âœ… AXIåè®®å®ç°æ­£ç¡®
- âœ… å¯„å­˜å™¨è®¿é—®æƒé™æ­£ç¡®
- âœ… æ—¶é’ŸåŸŸå¤„ç†å®‰å…¨
- âœ… æ•°æ®æµè·¯å¾„æ¸…æ™°
- âœ… è§¦å‘é€»è¾‘å®Œæ•´
- âœ… FIFOå®ç°å¯é 

### **ğŸ¯ IPæ ¸å°±ç»ªçŠ¶æ€**
**å½“å‰çŠ¶æ€ï¼šâœ… å‡†å¤‡å°±ç»ª**

IPæ ¸å·²ç»é€šè¿‡å…¨é¢æ£€æŸ¥ï¼Œå¯ä»¥ï¼š
1. æ­£å¸¸ç»¼åˆå’Œå®ç°
2. åœ¨Block Designä¸­ä½¿ç”¨
3. ä¸AXI DMAç­‰æ ‡å‡†IPè¿æ¥
4. æ”¯æŒå®Œæ•´çš„ç¤ºæ³¢å™¨æ•°æ®é‡‡é›†åŠŸèƒ½

### **ğŸ”§ å»ºè®®çš„ä¸‹ä¸€æ­¥æ“ä½œ**
1. åœ¨Vivadoä¸­é‡æ–°æ‰“åŒ…IPæ ¸
2. åœ¨Block Designä¸­æµ‹è¯•è¿æ¥
3. è¿è¡Œç»¼åˆéªŒè¯æ— é”™è¯¯
4. è¿›è¡Œç¡¬ä»¶æµ‹è¯•éªŒè¯

---
*æ£€æŸ¥æ—¶é—´ï¼š2025å¹´6æœˆ18æ—¥*
*æ£€æŸ¥ç‰ˆæœ¬ï¼šad9280_scop_2_0*
*æ£€æŸ¥çŠ¶æ€ï¼šâœ… å…¨é¢é€šè¿‡*
